var interviewRoom=function(e){var t,i,n,o,a,s={scs_url:"wss://localhost:18888",rcd_url:"",ice_servers:[{url:"stun:stun.l.google.com:19302"}],interview_id:null,user_id:null,user_type:null,token:null,need_interpreter:1,rcd_fragment_interval:3e4,rcd_v_bitrate:15e4,messages:[],err:{ERR_CONNECT_FAIL_API:[1e3,"对不起，不能连接服务器。"],ERR_INVALID_PARAMETER:[1001,"对不起，您没有进入该会诊室的权限。"],ERR_ALREADY_LOGIN:[1002,"对不起，您在别的地方中已经进入该会诊室。"],ERR_UNKNOWN_COMMAND:[1003,"对不起，服务器无法处理您的需求。"],ERR_INTERVIEW_NOT_PROGRESS:[1004,"因为该会诊还没开始，您无法进入。"],ERR_NO_INTERVIEW:[1005,""],ERR_NOPRIV:[10,""]},msg:{PATIENT:"患者",DOCTOR:"医生",INTERPRETER:"翻译",ONLINE:"在线",OFFLINE:"掉线",ALERT:"提示",PATIENT_ONLINE:"患者已在线",DOCTOR_ONLINE:"医生已在线",INTERPRETER_ONLINE:"翻译已在线",PATIENT_OFFLINE:"患者已掉线",DOCTOR_OFFLINE:"医生已掉线",INTERPRETER_OFFLINE:"翻译已掉线",ALERT_ERROR:"错误发生",INSTALL_CAMERA:"请安装摄像头和麦克风。",PERMIT_CAMERA:"请允许摄像头和麦克风的使用。",COULDNOT_ACCESS_CAMERA:"不能连接摄像头和麦克风。",CONNECTING:"服务器连接中，请耐心等候。",CONNECT_FAIL:"对不起，暂不能连接会诊服务器，请稍后再连接。",UNSUPPORT_WEBRTC:"对不起， 您使用的阅览器不支持影像对话，请使用Chrome等阅览器。",CONFIRM_FINISH_TITLE:"结束",CONFIRM_FINISH:"确定结束此次会诊？",FINISHING:"会诊结束中。",AUTOFINISHING:"医生还没上线，将会诊自动结束。",FINISHED:"会诊已结束。",WAITING:"请稍等..."},quality:"m",qualities:{h:{video:!0},m:{video:{mandatory:{maxWidth:640,maxHeight:480}},v_bitrate:500,a_bitrate:128},l:{video:{mandatory:{maxWidth:320,maxHeight:240}},v_bitrate:100,a_bitrate:30}}},c=null,d=["p","d","i","a"],u=null,l={},p={},_={},g={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},h=null,v=!1,f=!1,R=0,y=!1,I=!1,b=null,E=!0,T=!1;_.p=document.querySelector("#video_p"),_.d=document.querySelector("#video_d"),_.i=document.querySelector("#video_i");var N=function(){try{console.log.apply(this,arguments)}catch(e){console.log(arguments)}},O=function(){f?("a"!=c.user_type&&($("#chat_input").removeAttr("disabled"),$("#btn_send_message").removeAttr("disabled")),hideMask()):($("#chat_input").attr("disabled","disabled"),$("#btn_send_message").attr("disabled","disabled"),setTimeout(function(){f||I||showMask(c.msg.CONNECT_FAIL)},1e3))},C=function(e){u.send(JSON.stringify(e))},x=function(){if("a"==c.user_type)v=!0,D(null);else if(navigator.getUserMedia){(t=new MediaSource).addEventListener("sourceopen",function(){N("MediaSource opened"),o=t.addSourceBuffer('video/webm; codecs="vp8"'),N("Source buffer: ",o)},!1);var e=c.qualities[c.quality];navigator.getUserMedia({video:void 0==e||e.video,audio:!0},function(e){h=e,_[c.user_type].srcObject=h,_[c.user_type].muted=!0,window.RTCPeerConnection?($("#media_error_"+c.user_type).text(""),v=!0,D(e)):$("#media_error_"+c.user_type).text(c.msg.UNSUPPORT_WEBRTC)},function(e){switch(e.name){case"DevicesNotFoundError":case"NotFoundError":$("#media_error_"+c.user_type).text(c.msg.INSTALL_CAMERA);break;case"SecurityError":case"PermissionDeniedError":$("#media_error_"+c.user_type).text(c.msg.PERMIT_CAMERA);break;default:$("#media_error_"+c.user_type).text(c.msg.COULDNOT_ACCESS_CAMERA),N("Error opening your camera and/or microphone: "+e.message)}setTimeout(interviewRoom.openMyMedia,3e3)})}else $("#media_error_"+c.user_type).text(c.msg.UNSUPPORT_WEBRTC)},S=function(e,t){_[e].srcObject=t.stream},P={p:function(e){S("p",e)},d:function(e){S("d",e)},i:function(e){S("i",e)},a:function(e){}},A=function(e,t){t.candidate&&(N("candidate ",t.candidate),C({type:"candidate",mlineindex:t.candidate.sdpMLineIndex,candidate:t.candidate.candidate,user_type:e}))},M={p:function(e){A("p",e)},d:function(e){A("d",e)},i:function(e){A("i",e)},a:function(e){A("a",e)}},k=function(e,t){N("close peer connection ",e),l[e].sentOffer=!1},L=null,F=function(e,t){conn=new RTCPeerConnection(L),conn.sentOffer=!1,conn.user_type=t,e&&conn.addStream(e),conn.onaddstream=P[t],conn.onicecandidate=M[t],conn.onclose=k[t],l[t]=conn},D=function(e,t){for(var i in d)ut=d[i],ut==c.user_type||void 0!=t&&ut!=t||F(e,ut);O(),V(t)},V=function(e){if(v&&f)for(var t in p){var i=p[t].user_type;c.user_type!=i&&(void 0!=e&&e!=i||W(i))}},q=function(e){var t=c.qualities[c.quality];return void 0==t?(v_bitrate=null,a_bitrate=null):(v_bitrate=t.v_bitrate,a_bitrate=t.a_bitrate),e=z(z(e,"video",v_bitrate),"audio",a_bitrate)},z=function(e,t,i){if(null==i||void 0==i)return e;for(var n=e.split("\n"),r=-1,o=0;o<n.length;o++)if(0===n[o].indexOf("m="+t)){r=o;break}if(-1===r)return e;for(r++;0===n[r].indexOf("i=")||0===n[r].indexOf("c=");)r++;if(bline="b=AS:"+i+"\r",0===n[r].indexOf("b"))return N("Replaced b line with ",i),n[r]=bline,n.join("\n");N("Adding new b line with ",i);var a=n.slice(0,r);return a.push(bline),(a=a.concat(n.slice(r,n.length))).join("\n")},W=function(e){l[e].createOffer(g).then(function(t){t.sdp=q(t.sdp),l[e].setLocalDescription(t),C({type:"offer",offer:t,user_type:e}),l[e].sentOffer=!0}).catch(function(e){N(e)})},H=function(e){if(N("start reoffer"),void 0==e)for(var t in p){var i=p[t].user_type;i!=c.user_type&&H(i)}else D(h,e)},B=function(){y?$(".alert-waiting-doctor").addClass("hide"):$(".alert-waiting-doctor").removeClass("hide"),ne()},U=function(){var e=["p","d","i"],t=2,i=0;"1"==c.need_interpreter&&t++;for(var n in p){var r=p[n].user_type;switch($("#state_"+r).text(c.msg.ONLINE),r){case"p":m=c.msg.PATIENT_ONLINE,i++;break;case"d":m=c.msg.DOCTOR_ONLINE,i++;break;case"i":m=c.msg.INTERPRETER_ONLINE,i++;break;default:m=""}for(var o in e)r==e[o]&&delete e[o];$("#state_msg_"+r).text(m)}for(var o in e){r=e[o];switch($("#state_"+r).text(c.msg.OFFLINE),r){case"p":m=c.msg.PATIENT_OFFLINE;break;case"d":m=c.msg.DOCTOR_OFFLINE;break;case"i":m=c.msg.INTERPRETER_OFFLINE;break;default:m=""}$("#state_msg_"+r).text(m)}$("#stats").text(" ("+i+"/"+t+")")},j=function(e){for(var t in c.err)if((t=c.err[t])[0]==e)return t[1]},G=function(){setTimeout(function(){f||showMask(c.msg.CONNECTING)},1e3);try{u=new WebSocket(c.scs_url)}catch(e){return void N("Could not connect to server",e)}u.onopen=function(){N("connected"),C({type:"login",interview_id:c.interview_id,user_id:c.user_id,user_type:c.user_type,token:c.token,browser:$.browser})},u.onmessage=function(e){var t,i,n,r,o,a,s,d,u,m=function(e){var t;try{t=JSON.parse(e)}catch(i){N("Error parsing JSON."+e),t={}}return t}(e.data);switch(m.type){case"login":0==(u=m).err_code?(K(),"d"==u.user_type&&(y=!0,B()),p=u.onlines,U(),u.user_type==c.user_type&&(f=!0,O(),V(),interviewRoom.live(),!1!==u.doctor_offline_yet&&(N("doctor is offline yet."),setTimeout(interviewRoom.refreshWaitingDoctor,1e3*u.doctor_offline_yet)))):u.err_code==c.err.ERR_NO_INTERVIEW[0]||u.err_code==c.err.ERR_NOPRIV[0]?interviewRoom.go("interview"):errorBox(c.msg.ALERT_ERROR,j(u.err_code),function(){interviewRoom.go("interview")});break;case"offer":d=(s=m).user_type,0==s.err_code?(l[d].sentOffer&&F(h,d),offer=s.offer,l[d].setRemoteDescription(new RTCSessionDescription(offer)).then(function(){l[d].createAnswer(g).then(function(e){e.sdp=q(e.sdp),N("answer ",e);var t=l[d].setLocalDescription(e);return Z(h),C({type:"answer",answer:e,user_type:d}),t}).catch(function(e){N(e)})}).catch(function(e){N("onOffer ",e),setTimeout("interviewRoom.reoffer('"+d+"')",1e3)})):s.err_code==c.err.ERR_NO_INTERVIEW[0]||s.err_code==c.err.ERR_NOPRIV[0]?interviewRoom.go("interview"):errorBox(c.msg.ALERT_ERROR,j(s.err_code),function(){interviewRoom.go("interview")});break;case"answer":a=(o=m).user_type,0==o.err_code?(l[a].setRemoteDescription(new RTCSessionDescription(o.answer)).catch(function(e){N("onAnswer ",e),setTimeout("interviewRoom.reoffer('"+a+"')",1e3)}),Z(h)):o.err_code==c.err.ERR_NO_INTERVIEW[0]||o.err_code==c.err.ERR_NOPRIV[0]?interviewRoom.go("interview"):errorBox(c.msg.ALERT_ERROR,j(o.err_code),function(){interviewRoom.go("interview")});break;case"candidate":r=(n=m).user_type,0==n.err_code?l[r].addIceCandidate(new RTCIceCandidate({sdpMLineIndex:n.mlineindex,candidate:n.candidate})).catch(function(e){N("onCandidate ",e)}):n.err_code!=c.err.ERR_NO_INTERVIEW[0]&&n.err_code!=c.err.ERR_NOPRIV[0]||interviewRoom.go("interview");break;case"message":0==(i=m).err_code&&(msg={user_type:i.user_type,user_name:Y(i.user_type),content:i.content,no:i.no},X(msg),J(),$("#msg_"+msg.no+" .sending").addClass("hide"));break;case"live":!function(e){if(e.system_now){var t=Date.parse((new Date).toString());R=e.system_now-t,N("Sync time + "+R)}f&&setTimeout(interviewRoom.live,3e4)}(m);break;case"leave":!function(e){if(0==e.err_code){var t=e.user_type;t!=c.user_type&&_[t]&&(_[t].srcObject=null);for(var i in p)t==p[i].user_type&&delete p[i];U(),l[t].sentOffer=!1}}(m);break;case"finish":t=m,hideMask(),0==t.err_code?(I=!0,alertBox(c.msg.ALERT,c.msg.FINISHED,function(){interviewRoom.go("interview")})):t.err_code==c.err.ERR_NO_INTERVIEW[0]||t.err_code==c.err.ERR_NOPRIV[0]?interviewRoom.go("interview"):errorBox(c.msg.ALERT_ERROR,j(t.err_code))}},u.onerror=function(e){N("got error",e)},u.onclose=function(e){N("close socket",e);try{for(var t in d)ut=d[t],ut!=c.user_type&&"closed"!=l[ut].signalingState&&l[ut].close()}catch(e){}f=!1,T||(K(),O(),setTimeout(interviewRoom.connect(),4e3))}},K=function(){$(".state").text(c.msg.OFFLINE),$("#state_msg_p").text(c.msg.PATIENT_OFFLINE),$("#state_msg_d").text(c.msg.DOCTOR_OFFLINE),$("#state_msg_i").text(c.msg.INTERPRETER_OFFLINE)},Y=function(e){switch(e){case"p":return c.msg.PATIENT;case"d":return c.msg.DOCTOR;case"i":return c.msg.INTERPRETER}},J=function(e){void 0===e&&(e=1e3),$("#chat_view").animate({scrollTop:$("#chat_view")[0].scrollHeight},e)},Q=function(e,t){var i="";return i+='  <span class="user-name '+(e.user_type==c.user_type?"me":"")+'">'+e.user_name+"</span>",i+='  <div class="chat-message left">',t&&(i+='    <div class="sending"><span><i class="fa fa-spinner fa-spin"></i></span></div>'),i+='    <div class="message '+(e.user_type==c.user_type?"me":"")+'">'+e.content+"</div>",i+='    <div class="clear"></div>',i+="  </div>"},X=function(e,t){var i="";$("#msg_"+e.no).length?(i=Q(e,t),$("#msg_"+e.no).html(i)):(i='<div class="message-wrapper" id="msg_'+e.no+'">',i+=Q(e,t),i+="</div>",$("#chat_view #messages").append(i)),t&&J()},Z=function(e){if(null!=e&&""!=c.rcd_url&&(!i||"recording"!=i.state)){try{n=[];c.qualities[c.quality];var t={audioBitsPerSecond:12800,videoBitsPerSecond:c.rcd_v_bitrate,mimeType:"video/webm;codecs=vp9"};MediaRecorder.isTypeSupported(t.mimeType)||(N(t.mimeType+" is not Supported"),t.mimeType="video/webm;codecs=vp8",MediaRecorder.isTypeSupported(t.mimeType)||(N(t.mimeType+" is not Supported"),t.mimeType="video/webm",MediaRecorder.isTypeSupported(t.mimeType)||(N(t.mimeType+" is not Supported"),t={mimeType:""}))),i=new MediaRecorder(e,t)}catch(e){return i=null,void N("Exception while creating MediaRecorder: "+e+". mimeType: "+t.mimeType)}N("Start record ",i,"with options",t),i.onstop=function(e){N("Recorder stopped: ",e),te()},i.ondataavailable=function(e){e.data&&e.data.size>0&&n.push(e.data)},ee()}},ee=function(e){i&&(e?"recording"==i.state&&i.stop():(b=Date.parse((new Date).toString()),b+=R,a=0),i.start(10),N("MediaRecorder started",i),setTimeout("interviewRoom.startRecording(true)",c.rcd_fragment_interval))},te=function(){N("Recorded Blobs: ",n.length);var e=new Blob(n,{type:"video/webm"}),t=new FormData;t.append("interview_id",c.interview_id),t.append("user_type",c.user_type),t.append("timestamp",b),t.append("no",a),t.append("data",e,"data"),$.ajax({type:"POST",url:c.rcd_url+"api/v/p",data:t,processData:!1,contentType:!1}).done(function(e){E=!0}).fail(function(e,t){E=!0}),n=[],a++},ie=function(){i&&"recording"==i.state?(E=!1,i.stop()):E=!0,N("Stop record"),i=null},ne=function(){alert_height=$(".alert-waiting-doctor").height(),c_width=$("article").width(),c_height=$("article").height()-alert_height,v_max_width=c_width/2-15,st_height=$(".row-big h4").height()+parseInt($(".row-big h4").css("margin-top"))+parseInt($(".row-big h4").css("margin-bottom"))+parseInt($(".row-big h4").css("padding-top"))+parseInt($(".row-big h4").css("padding-bottom")),l_height=$(".row-big h3").height()+parseInt($(".row-big h3").css("margin-top"))+parseInt($(".row-big h3").css("margin-bottom"))+parseInt($(".row-big h3").css("padding-top"))+parseInt($(".row-big h3").css("padding-bottom")),"1"==c.need_interpreter?(s_height=$(".row-small").height()+parseInt($(".row-small").css("margin-top"))+parseInt($(".row-small").css("margin-bottom"))+parseInt($(".row-small").css("padding-top"))+parseInt($(".row-small").css("padding-bottom")),v_height=c_height-s_height-st_height-l_height-10):v_height=c_height-st_height-l_height-10,v_width=Math.floor(v_height/.75),v_width>v_max_width&&(v_width=v_max_width,v_height=Math.floor(.75*v_width)),$(".video-big").height(v_height).width(v_width),$("article h4").each(function(){w=$(this).siblings("video").width(),$(this).width(w),$(this).parent().find(".video-bar").width(w)}),b_height=$(".row-big").height(),s_height=$(".row-small").height(),padding=parseInt((c_height-b_height-s_height)/2),$("article .room-main").css("padding-top",padding+"px").css("padding-bottom",padding+"px"),a_height=$("aside").height()-parseInt($("aside").css("padding-top"))-parseInt($("aside").css("padding-bottom")),$("aside > *").each(function(){$(this).hasClass("chat-panel")||(a_height-=$(this).height()+parseInt($(this).css("margin-top"))+parseInt($(this).css("margin-bottom"))+parseInt($(this).css("padding-top"))+parseInt($(this).css("padding-bottom")))}),panel=$("aside .chat-panel"),a_height-=parseInt(panel.css("margin-top"))+parseInt(panel.css("margin-bottom"))+parseInt(panel.css("padding-top"))+parseInt(panel.css("padding-bottom")),panel.height(a_height),re(),$(".interview-room").removeClass("transparent")},re=function(){var e,t,i,n,o,a,s,d,u,l,p,m,_,g,h,v,f,w,R,y,I;t=$("#chat_input"),R=t[0],p=function(){var e,t;e=v,t=getComputedStyle(R);for(var i in d)val=d[i],e+=val+":"+t.getPropertyValue(val)+";";h.setAttribute("style",e)},n=function(){var e,t,i,n,r,a;r=void 0,n=void 0,t=void 0,a=void 0,i=void 0,f!==R&&p(),e||(e=!0,h.value=R.value+o,h.style.overflowY=R.style.overflowY,r=""===R.style.height?"auto":parseInt(R.style.height,10),"px"===(n=getComputedStyle(R).getPropertyValue("width")).substr(n.length-2,2)&&(a=parseInt(n,10)-s.width,h.style.width=a+"px"),(t=h.scrollHeight)>m?(t=m,i="scroll"):t<_&&(t=_),(t+=s.height)<24&&(t=24),R.style.overflowY=i||"hidden",r!==t&&(R.style.height=t+"px"),adjustMessages(),e=!1)},adjustMessages=function(){taheight=parseInt(R.style.height),ct_height=$(".chat-panel").height()+parseInt($(".chat-panel").css("padding-top"))+parseInt($(".chat-panel").css("padding-bottom")),$(".chat-container").height(ct_height-taheight-parseInt(getComputedStyle(R).getPropertyValue("padding-top"))-parseInt(getComputedStyle(R).getPropertyValue("padding-top"))-15)},u=function(){n(),adjustMessages()},t.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word","max-height":"88px"}),I=R.value,R.value="",R.value=I,o="",i=$(window),v="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",e=$('<textarea tabindex="-1" style="'+v+'"/>').data("elastic",!0),h=e[0],w=(y=getComputedStyle(R)).getPropertyValue("resize"),a="border-box"===y.getPropertyValue("box-sizing")||"border-box"===y.getPropertyValue("-moz-box-sizing")||"border-box"===y.getPropertyValue("-webkit-box-sizing"),s=a?{width:parseInt(y.getPropertyValue("border-right-width"),10)+parseInt(y.getPropertyValue("padding-right"),10)+parseInt(y.getPropertyValue("padding-left"),10)+parseInt(y.getPropertyValue("border-left-width"),10),height:parseInt(y.getPropertyValue("border-top-width"),10)+parseInt(y.getPropertyValue("padding-top"),10)+parseInt(y.getPropertyValue("padding-bottom"),10)+parseInt(y.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},g=parseInt(y.getPropertyValue("min-height"),10),l=parseInt(y.getPropertyValue("height"),10),_=Math.max(g,l)-s.height,m=parseInt(y.getPropertyValue("max-height"),10),f=void 0,d=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"],t.data("elastic")||(m=m&&m>0?m:9e4,h.parentNode!==document.body&&$(document.body).append(h),t.css({resize:"none"===w||"vertical"===w?"none":"horizontal"}).data("elastic",!0),$("#input_bar").on("submit",function(){$("#message_no").val((no=c.user_type+"_",now=new Date,no+=formatDate(now,"yyyyMMddhhmmss"),no)),content=$("#chat_input").val(),""!=content&&(no=$("#message_no").val(),C({type:"message",content:content,no:no}),msg={user_type:c.user_type,user_name:Y(c.user_type),content:content,no:no},X(msg,!0))}),$("#input_bar").ajaxForm({dataType:"json",success:function(e,t,i,n){try{if(0==e.err_code)return $("#chat_input").val(""),void $("#chat_input")[0].oninput();r.err_code==c.err.ERR_NOPRIV[0]?interviewRoom.go("interview"):errorBox(c.msg.ALERT_ERROR,e.err_msg)}finally{}}}),$("#chat_input").on("keydown",function(e){13==e.keyCode&&0==e.altKey&&0==e.ctrlKey&&0==e.shiftKey?(e.preventDefault(),$("#input_bar").submit()):27==e.keyCode&&($("#chat_input").val(""),$("#chat_input")[0].oninput())}),R.oninput="onpropertychange"in R&&"oninput"in R?R.onkeyup=n:n,i.bind("resize",u),n())};return{init:function(e){(c=$.extend(s,e)).ice_servers&&(L={iceServers:c.ice_servers}),K(),x(),G(),$(".btn-start").click(function(){quality=$("#quality").val(),interviewRoom.go("interview/room/"+c.interview_id+"/"+quality+"?"+Math.round(100*Math.random()))}),$(".btn-finish").click(function(){confirmBox(c.msg.CONFIRM_FINISH_TITLE,c.msg.CONFIRM_FINISH,function(){showMask(c.msg.FINISHING),C({type:"finish",interview_id:c.interview_id})})}),$(".btn-exit").click(function(){I=!0,interviewRoom.go("interview/")}),$("#quality").change(function(){quality=$("#quality").val(),interviewRoom.go("interview/room/"+c.interview_id+"/"+quality+"?"+Math.round(100*Math.random()))}),$(window).resize(function(){w_height=$(window).height(),$(".interview-room").height(w_height),setTimeout(interviewRoom.resizeLayouts,1)}),$(window).resize();for(var t in c.messages)X(c.messages[t]);J(1),interviewRoom.clock(),function(){var e=function(){var e=!0;if(h){var t=h.getAudioTracks();for(var i in t)t[i].enabled||(e=!1)}return e},t=function(e){e?$(".btn-mic").addClass("ln-icon-mic").removeClass("ln-icon-mic-mute"):$(".btn-mic").addClass("ln-icon-mic-mute").removeClass("ln-icon-mic")};t(e()),$(".btn-mic").click(function(){if(mic=e(),mic?mic=!1:mic=!0,h){var i=h.getAudioTracks();for(var n in i)i[n].enabled=mic}t(e())});var i=0;for(var n in _)i<$(_[n]).prop("volume")&&(i=$(_[n]).prop("volume"));$(".btn-volume .slider").slider({orientation:"vertical",range:"min",min:0,max:1,step:.01,value:i,slide:function(e,t){for(var i in _)$(_[i]).prop("volume",t.value);$(".btn-volume i").removeClass("ln-icon-volume-low").removeClass("ln-icon-volume-high").removeClass("ln-icon-volume-medium").removeClass("ln-icon-volume"),0==t.value?$(".btn-volume i").addClass("ln-icon-volume"):t.value<.3?$(".btn-volume i").addClass("ln-icon-volume-low"):t.value<.7?$(".btn-volume i").addClass("ln-icon-volume-medium"):$(".btn-volume i").addClass("ln-icon-volume-high")}})}(),setInterval(function(){interviewRoom.checkStatus()},3e4)},start:V,reoffer:H,resizeLayouts:ne,connect:G,live:function(){f&&C({type:"live"})},refreshWaitingDoctor:B,go:function(e,t){void 0!==t&&1!=t||(showMask(c.msg.WAITING),u&&(T=!0,ie(),u.close())),E?goto_url(e):setTimeout("interviewRoom.go('"+e+"', false)",1e3)},clock:function(){var e=Date.parse((new Date).toString());sys_now=e+R,(e=new Date).setTime(sys_now),$("#clock").text(formatDate(e,"HH:mm:ss")),setTimeout(interviewRoom.clock,1e3)},openMyMedia:x,startRecording:ee,checkStatus:function(){App.callAPI("api/interview/status",{interview_id:c.interview_id}).done(function(e){6==e.status||(8==e.status?(showMask(c.msg.FINISHING),setTimeout(function(){u.close(),interviewRoom.go("interview")},2e3)):10==e.status?(showMask(c.msg.FINISHING),setTimeout(function(){u.close(),interviewRoom.go("interview")},2e3)):(u.close(),interviewRoom.go("interview")))}).fail(function(e){})}}}();