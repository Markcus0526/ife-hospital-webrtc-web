1. DB구축
	이번에 db에 대하여 많은 수정을 진행하였으므로 미안한대로 이번까지 마지막으로 다시 구축하여주십시오.
	앞으로 체계갱신시의 db갱신은 patch에 의하여 자동으로 진행되게 됩니다.
	이번 db변경에서 다음과 같은 문제들이 주로 변경되였습니다.
	1. datetime->timestamp로 모두 바꾸었습니다.
	대상특성상 다중 timezone에서 동작하여야 하므로 시간대에 의존하지 않는 자료형인 timestamp를 리용하였습니다.
	이때문에 말단사용자의 체계시간대에 따라 같은 회진예약시간도 서로 다르게 나타나게 됩니다.
	2. SMS송신의 batch처리
	SMS송신은 다른 봉사기의 web api호출을 진행하므로 호출timeout이 발생하면 web봉사기의 응답성이 저하되는 문제가 있습니다.
	이때문에 꼭 즉시송신(사용자가입, 등록등)이 아닌 일반 상태변경 SMS는 batch로부터 15초정도간격으로 묶어서 송신되게됩니다.
	3.회진table의 상태조종기능 보강
	회진의 상태조종을 위하여 여러가지 마당들을 추가하였습니다.
	4. 다국전화번호대응
	db에서 모든 전화번호는 나라별 dialcode 를 추가한상태로 보존됩니다.

	새 DB등록후 검사용으로 사용할수 있는 계정은 아래와 같습니다.
	가입시에 dialcode는 생략하고 입력할수도 있고 그대로 입력할수도 있습니다.
			mobile 	password
	관리자 	004		111
	초급		005		111
	환자		001		111
	의사		002		111	
	통역원	003		111

2.web봉사기구축
봉사기는 이전과 같이 apache/php환경을 리용합니다.
- httpd.conf에 아래와 같이 등록부를 추가합니다.
	Alias를 리용하는 경우(실례 teleclinic라는 alias인 경우 )
	
	Alias /teleclinic "d:\teleclinic\www"
	<Directory " d:\teleclinic\www">
	    AllowOverride All
	    Require all granted
	</Directory>
	
	DocumentRoot를 리용하는 경우
	
	DocumentRoot "d:\teleclinic\www"
	<Directory " d:\teleclinic\www">
	    AllowOverride All
	    Require all granted
	</Directory>
- .htaccess화일을 수정합니다.
	Alias를 리용하는 경우(실례 teleclinic라는 alias인 경우 )
	배포본에 있는 www/.htaccess화일에서 RewriteBase를 아래와 같이 변경합니다.
		RewriteBase /teleclinic

	DocumentRoot를 리용하는 경우 
	배포본에 있는 www/.htaccess화일에서 RewriteBase를 아래와 같이 변경합니다.
		RewriteBase /
- 리눅스환경인 경우 www\data와 www\tmp등록부에 쓰기권한을 설정합니다.
	이 등록부에는 upload되는 화일들이 올라갑니다.
- SSL설정
	webrtc특성상 https가 아니면 camera자원에 대한 접근이 불가능합니다.
	ssl설정은 httpd-ssl.conf에서 진행합니다.
	주요한 설정부분은 아래의 private key와 certicate설정부분입니다.
	SSLCertificateKeyFile "conf/ssl.key/server.key"
	SSLCertificateFile "conf/ssl.crt/server.crt"

	만일 아직 cert가 없다면 apache기정설치시에 설치되는 self sign cert를 사용할수 있습니다.
	이 경우 chrome등에서 security경고화면이 뜨는데 수동으로 allow시켜주어야 합니다.
- config.inc의 수정
	www/config.inc에서 설정정보를 변경하여야 합니다.
	* DB설정
	db는 DB_HOSTNAME, DB_USER, DB_PASSWORD, DB_NAME, DB_PORT를 변경하여아 합니다.
	아래는 local환경에 db를 설치한 경우입니다.
	define('DB_HOSTNAME',		'localhost');
	define('DB_USER',		'root');
	define('DB_PASSWORD',		'');
	define('DB_NAME',		'teleclinic');
	define('DB_PORT',		3306);

	* SCS(signaling chat server)봉사기 설정
	webrtc는 rtc통신전에 offer와 answer라는 sdp교환공정을 거칩니다. 
	이 sdp를 교환시키 위한 websocket봉사기를 signaling봉사기라고 합니다.
	실례로 SCS를 192.168.12.128에 18888포구에 기동시킨 경우 아래와 같이 설정합니다.
	define('SCS_URL',		'wss://192.168.12.128:18888');
	여기서 개발한 SCS봉사기는 signaling과 함께 문자대화통신도 보장합니다.

	* ICE봉사기 설정
	webrtc는 NAT뒤에 있는 말단에 대하여 통신 보장을 위하여 stun이나 turn봉사기를 지정할필요가 있습니다.
	turn봉사기의 경우 모든 rtc통신내용이 turn봉사기를 거치므로 부하가 생길수 있습니다.
	아래는 google에서 표준 제공하는 stun봉사기를 지정한 경우입니다.
	define('ICE_SERVERS',		'[{url:"stun:stun.l.google.com:19302"}]');
	ice봉사기는 여래대 지정가능합니다.
	실례로 자체로 192.168.12.128에 turn봉사기를 설치한 경우는 아래와 같습니다.
	포구는 봉사기에 설정한 포구를 지정하면 됩니다.
	define('ICE_SERVERS',		'[{url:"stun:stun.l.google.com:19302"},{url:"turn:192.168.12.128:44303"}]');
	자체 stun와 turn봉사기를 설치할때 주의점은 봉사기에 두개의 망카드(즉 두개의 ip주소)가 설치되여야 합니다.

	* 시간대지정
	define('TIME_ZONE',		'GMT+800');
	이 체계는 다중시간대에 대응하고 있습니다.
	모든 시간은 web봉사기의 시간에 기준하여 맞추어집니다.
	web봉사기의 시간대를 우와 같이 TIME_ZONE에 GMT+xxx의 형식으로 지정하여주십시오.
	GMT+800은 beijing표준시간대로 설정한 경우입니다.

	* SMS설정
	SMS통신은 jianyu와 같은 봉사를 리용합니다.
	해당봉사에 등록한 SMS_USER와 SMS_PASSWORD를 지정하여주십시오.

	* 기타 체계설정값
	요구사항에서 일부 미확정된 요구사항(위약금액)이나 중요설정값들은 config.inc에서 변경가능합니다.
	해당 값의 설명내용은 주석을 참고하여주십시오.
	/* 翻译费用 */
	define('INTERPRETER_FEE',		200);
	/* 页面刷新 */
	define('REFRESH_INTERVAL',		15);
	/* 会诊支付期限(分钟) */
	define('INTERVIEW_PAY_LIMIT',		30);
	/* 会诊前提醒(分钟) */
	define('INTERVIEW_ALARM_START',		30);
	/* 患者能同意更改时间的期限(分钟) */
	define('INTERVIEW_ACCEPT_TIME_LIMIT',		30);
	/* 对话者没在*分钟内上线,自动结束会诊 */
	define('INTERVIEW_OFFLINE_LIMIT',		15);
	/* 对话者在会诊开始*分钟仍没上线时 */
	define('INTERVIEW_ALARM_OFFLINE_LIMIT',		5);
	/* 患者在*分钟内没有执行是否继续同意的操作，则短信通知普通管理员 */
	define('INTERVIEW_P_ACCEPT_CTIME_LIMIT',		30);
	/* 如果翻译在*分钟内没有执行是否继续接单的操作，则默认不继续接单，走“否”的情况 */
	define('INTERVIEW_I_ACCEPT_CTIME_LIMIT',		60);
	/* 翻译无违约金取消期限(时间) */
	define('INTERVIEW_I_CANCEL_LIMIT',		24);
	/* 违约金 */
	define('PENALTY_AMOUNT',		100);

	* 록화봉사기 API URL
	동화상록화를 진행하는 봉사기의 URL을 설정합니다. 마감에 반드시 "/"를 붙여주십시오.
	대화중에 해당 봉사기에 올리게 되므로 반드시 https를 사용하여야 합니다.
	http를 사용한 경우 security경고로 됩니다.
	이 값이 빈문자렬인 경우 동영상록화는 진행하지 않습니다.
	define('RECORDING_API',		'https://192.168.12.128/recording/');
- apache를 재기동 시킵니다.
- 열람기로부터 https://192.168.12.128/teleclinic와 같이 https로 엽니다.

3. batch설정
각 회진의 상태정보를 갱신하거나 sms의 송신, 낡은 자료(session, sms, access log, chat history등)의 삭제는 batch를 통하여 진행됩니다.
- batch service는 apache가 있는 봉사기에 함께 기동시킵니다.
- 먼저 www/resource/service/batch.ini화일에 www등록부의 절대 경로를 기입합니다.
실례로 /var/www/html에 설치한 상태라면 
/var/www/html
을 주면 됩니다.
- 다음 아래의 지령을 service를 설치합니다.
# cd resource/service
# chmod -R 777 *
# ./install_batch.sh
- 설치가 정상으로 되면 아래의 지령으로 batch를 기동시킵니다.
# service teleclinic_batch start
- batch의 내부동작구조
batch service는 내적으로 www/batch.php를 console로부터 
# php batch.php
로 실행시킵니다.
이때문에 batch.php의 동작으로 인한 web봉사기부하는 없습니다.
만일 봉사기에 문제가 발생하는 경우 
# service teleclinic_batch stop
# php batch.php
를 실행하여 직접 동작확인을 할수 있습니다.

4. SCS봉사기 구축
SCS는 signaling과 chat를 진행하기 위한 봉사기입니다.
node로 작성되여있습니다.
검사시에는 web봉사기에 함께 설치할수 있으나 실제 운영에서는 별도로 구축하여주십시오.
- node의 설치
	node는 4.2.1을 설치하여주십시오.
- 현재 납품물의 scs에 여기서 사용하는 node_modules를 넣었지만 가능하면 거기서 최신판본을 받아서 리용하여주십시오.
	즉 여기서 보내는 node_modules는 삭제하고 최신판을 받으면 됩니다.
	# cd scs
	# npm install
	만일 필요한 node module들을 정상으로 받을수 없거나 봉사기가 정상동작하지 않는 경우는 여기서 보낸 node_modules를 리용하면 됩니다.
- 봉사기 설정
	봉사기 설정은 config.js에서 진행합니다.

	아래는 기정의 봉사기설정입니다.
	var keyPath = 'D:/xampp/apache/conf/';
	exports.server_name = "Teleclinic SC(Signaling & Chat) Server";
	exports.ssl = true;
	exports.port = 18888;
	exports.ssl_key = keyPath + 'ssl.key/server.key';
	exports.ssl_cert = keyPath + 'ssl.crt/server.crt';
	exports.api_prefix = "http://192.168.12.128/teleclinic/api/";

	우의 설정은 봉사기포구를 18888로 지정하고 있습니다.
	그리고 ssl통신에 필요한 key와 cert화일의 경로도 지정하고 있습니다.
	다음으로 web봉사기의 통신에 필요한 api url도 지정하여주십시오.
	실례로 http://192.168.12.128/teleclinic에 web봉사기를 설치한 경우 api url prefix는 http://192.168.12.128/teleclinic/api/로 됩니다.

주의점: 현재 scs의 포구는 검사용으로 18888을 쓰고 있지만 실지환경에서는 봉사기를 별도로 설치하여 443번포구(https)를 사용하도록 하여주십시오.
이것은 방화벽등에서 해당 포구가 차단되는것을 막기 위하여 필요합니다.
실례로 443번 포구를 사용한 경우 
	wss://scs.teleclinic.com:443과 같은 형식으로 됩니다.

- 봉사기를 daemon으로 등록
	scs/service/scs.ini화일을 열고 여기에 scs가 설치된 절대경로를 기입합니다.
	다음의 지령으로 daemon을 등록합니다.
	# cd service
	# chmod -R 777 *
	# ./install_scs.sh
	daemon의 기동
	# service scs start

- scs의 내부동작구조
scs service는 내적으로 scs/server.js를 console로부터 
# node server.js
로 실행시킵니다.

5. 다국어 대응문제
현재 요구사항대로  중문과 영문을 대응하고 있습니다.
다만 영문은 여기서 번역하였으므로 번역질이 높지 못합니다.
가능하면 주문자가 번역하도록 하여주십시오.
번역은 resource/lang/en-US.php를 변경하면 됩니다.

현재 체계에는 영문화일을 생성하기 위한 도구가 준비되여있습니다.
www등록부에 있는 lang.php를 실행시키면 갱신된 en-US.php화일이 생성됩니다.
실례로 /var/www/html에 설치하고 있는 경우
# cd /var/www/html
# php lang.php en-US
를 실행하면 모든 php원천코드를 분석하여 번역해야할 내용이 en-US.php에 갱신되여 반영됩니다.

6.회진실검사와 관련하여
거기서 회진예약을 하고 회진실검사를 진행하려면 db내용을 변경하면서 해야 될것입니다.
즉 회진은 24시간이후의것만 등록할수 있으므로 등록하고 즉시에 검사하려면 수동으로 db를 변경해야 합니다.
그러므로 db구조에 대하여 알필요가 있습니다.
회진은 t_interview table에 보관됩니다. 각 마당의 의미는 아래와 같습니다.
		"interview_id",			// 会诊ID
		"patient_id",			// 患者ID
		"doctor_id",			// 医生ID
		"interpreter_id",		// 翻译ID
		"reserved_starttime",	// 会诊开始预定时刻
		"reserved_endtime",		// 会诊完毕预定时刻
		"chistory_id",			// 病历ID
		"planguage_id",			// 患者精通语言
		"dlanguage_id",			// 医生精通语言
		"need_interpreter",		// 是否需要翻译
		"status",				// 状态
		"sub_status",			// 部分状态
		"cancel_cause_id",
		"cancel_cause_note",
		"interview_starttime",	// 会诊开始时刻
		"interview_endtime",	// 会诊完毕时刻
		"interview_seconds",	// 会诊时长
		"record_video",			// 
		"patient_status",		// 患者上线状态
		"patient_starttime",	// 患者开始时刻
		"patient_leavetime",	// 患者掉线时刻
		"patient_ip",			// 患者IP
		"doctor_status",		// 医生上线状态
		"doctor_starttime",		// 医生开始时刻
		"doctor_leavetime",		// 医生掉线时刻
		"doctor_ip",			// 医生IP
		"interpreter_status",	// 翻译上线状态
		"interpreter_starttime",// 翻译开始时刻
		"interpreter_leavetime",// 翻译掉线时刻
		"interpreter_ip",		// 翻译IP
		"cost",					// 会诊费
		"d_cost",				// 医生费
		"i_cost",				// 翻译费
		"filesize",
		"doctor_sign",
		"prescription",			// 诊疗方案
		"chat_file",			// 讨论内容
		"change_time_at",		// 更改时间时刻
이밖에 기타 table에서 마당의 의미는 해당 model화일을 열어보면 거기에 주석이 있으므로 참고할수 있습니다.
실례로 병력서(t_chistory) table인 경우 application/model/chistoryModel.php에 정의되여 있으며 각마당의 의미는 
_model함수를 통하여 주석처리되여있습니다.
또한 회진의 상태값들은 consts.php에서 ISTATUS_*로 시작됩니다.
	define("ISTATUS_NONE",						0); // 待付款
	define("ISTATUS_PAYED",						2); // 已付款
	define("ISTATUS_OPENED",					4); // 已生效
	define("ISTATUS_PROGRESSING",				6); // 进行中
	define("ISTATUS_FINISHED",					8); // 已完成
	define("ISTATUS_CANCELED",					10); // 已失效

7. stun & turn봉사기 설치방법
- stun봉사기 설치방법
리눅스환경에서 stund-0.97.tgz를 압축해제하고 compile합니다.
# tar xzvf stund-0.97.tgz
# cd stund
# make
실행은 아래와 같습니다.
#  ./server -b -h [기본IP주소] -a [보조IP주소] -p [기본IP의 포구번호] -o [보조IP의 포구번호]

- turn봉사기 설치방법
turn봉사기는 여기서 필요한 package들을 얻을수 없으므로 동작확인은 해보지 못하였습니다.
compile이나 설치는 아래와 같습니다.
리눅스환경에서 rfc5766-turn-server-3.2를 압축해제하고 compile합니다.
$ tar zvf rfc5766-turn-server-3.2.zip
$ sudo yum install openssl-devel
$ sudo yum install libevent
$ sudo yum install libevent-devel
$ sudo yum install postgresql-devel
$ sudo yum install postgresql-server
$ sudo yum install mysql-devel
$ sudo yum install mysql-server
$ sudo yum install hiredis
$ sudo yum install hiredis-devel
$ ./configure
$ make
$ make install
설정이나 기동방법은 examples/readme.txt를 참고하여주십시오.
$ sudo cp -r examples/etc/* /etc

8. 록화봉사기설정
회진내용에 대한 록화를 위하여 별도의 록화봉사기를 구축하여주십시오.
록화봉사기는 windows, linux모두에서 동작가능합니다.
록화봉사기는 홈페지와 같이 web봉사기로 구성됩니다.
- ffmpeg설치
	ffmpeg를 설치하고 ffmpeg실행화일이 들어있는 경로를 path에 등록하여 되도록 console로부터 ffmpeg만으로 직접 실행할수 있도록 해주십시오.
- web봉사기설치
	여기서 제공하는 recording package를 설치하면 됩니다.
	config.inc지정은 기본홈페지와 기본상 같습니다.
	현재 록화봉사기는 db등을 리용하지 않지만 앞으로 리용할 가능성이 있으므로 DB설정등을 기본홈페지의 config.inc와 같이 맞추어주십시오.
- config.inc에서 ffmpeg지정
	config.inc에 ffmpeg상수를 지정합니다.
	path에 등록한 경우는 그대로 ffmpeg를 쓰거나 그렇지 않은 경우 /usr/bin/ffmpeg와 같이 실행경로를 직접줄수 있습니다.
	실례.
	define('FFMPEG',		'/usr/bin/ffmpeg');
- data와 tmp등록부를 쓰기권한설정하여주십시오.
- batch설정
	록화봉사기도 기본홈페지와 꼭같은 방식으로 daemon등록할수 있습니다.
	등록후
	# service recording start
	로 기동하면 됩니다.
- 록화과정의 설명
	록화가 시작되면 회진실의 말단에서 카메라와 마이크로부터 동영상stream을 얻고 이것을 리용하여 록화를 진행합니다.
	현재는 실시간적으로 봉사기에 록화영상을 보낼수 있는 방법(rtps와 같은 표준규약)이 없으므로 말단에서 30초간격으로 록화동영상을 생성하고 그것을 
	록화봉사기에 전송합니다. 30초사이에 생성되는 록화영상의 용량은 현재 최저로 낮추어 350KB정도입니다.
	록화봉사기에서는 각 대화자들로부터 전송되는 록화영상을 tmp/등록부에 보관합니다.
	올려지는 동영상은 아래의 구조로 보관됩니다.
	tmp
	   /[interview_id]
			/[user_type]
				/[con_timestamp]
					/[no]
	실례로
	tmp/20171101040028/p/1432342/00004.webm
	이라는 화일은 회진번호가 20171101040028인 회진에서 p(환자)가 1432342시간에 접속하여 4분~4분30초사이의 록화된 동영상이 들어있습니다.
	의사가 결속단추를 눌러서 회진을 결속하면 tmp/[interview_id].fin이라는 화일이 생기며 1분정도지나서부터 batch에 의하여 록화영상을 합성하기 시작합니다.
	모든 쪼각의 합성이 끝나면 최종화상이
	data/video/[year]/[month]/[interview_id].webm
	에 보관되게 됩니다. 
	실례로 우의 경우는 data/video/2017/11/20171101040028.webm화일이 생성되게 됩니다.

록화봉사기는 기본홈페지의 봉사부하를 줄이기 위하여 반드시 별도로 운영하도록 하며 앞으로 여러대를 설치하여 부하분산을 진행하여야 한다고 생각합니다.
현재는 한대이지만 다음단계개발등에서 부하분산기능을 제안하여 구현하였으면 합니다.

8. 지불설정
현재 체계는 3가지 지불동작방식으로 동작하고 있습니다.
지불동작방식은 config.inc에서 DEBUG_PAY값으로 설정합니다.
각 설정값은 아래와 같습니다.
0: production용 증명서를 사용하여 지불을 진행합니다. 즉 실지 지불이 이루어집니다.
1: test용 증명서를 사용하여 지불을 진행합니다. 외부지불체계와 실제적인 api호출을 진행하지만 실제적인 지불은 발생하지 않습니다. 실지운영중에 검사용으로 사용합니다.
2: 실지 지불체계와의 어떠한 통신도 진행하지 않으며 지불처리는 본 체계가 모의하여 진행합니다. 이 방식에서 모든 지불은 항상 성공하는것으로 됩니다.
초급관리자로 가입하여 系统管理	>系统设置화면에서 필요한 설정을 진행하여주십시오.
- Yinlian지불설정
商家号: Yinlian홈페지에 등록한 상점ID를 여기에 입력합니다.
签名证书密码: 서명증명서의 암호를 입력합니다.
그밖의 签名证书路径,加密证书路径,验签中级证书路径,验签根证书路径,日志打印路径은
체계로부터 고정설정됩니다. 화일이름, 경로등은 모두 고정이므로 홈페지에서 받은 증명서를 해당 등록부에 이름을 바꾸어 
복사하여주십시오.
앞으로 모든 증명서는 resource/cert에서 통일보관합니다. 
주의: resource/cert등록부는 htaccess부터 외부에서 접근하지 못하도록 차단하고 있습니다.
- PayPal지불설정
DEBUG_PAY=0인 경우 실지불방식으로 DEBUG_PAY=1인 경우는 sandbox방식으로 동작합니다.
PayPal账号（邮件地址）: www.paypal.com에 등록한 계정 우편주소입니다.
PayPal로부터 공개증명서(Certificate PKCS12 (.p12))와 사유증명서(Private Key), PayPal증명서를 받아서
resource/cert/paypal에 복사하여주십시오.
보관되여야 할 화일이름은 고정이며 화일이름은 체계설정화면에서 확인할수 있습니다.
Identity Token, Cert ID , Private Key密码는 PayPal홈페지로부터 받아서 설정하여주십시오.